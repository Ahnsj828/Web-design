<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <title>ë¡œê·¸ì¸ ëª¨ë‹¬ (cart UX)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      /* ìŠ¤í¬ë¡¤ ì ê¸ˆ */
      body.modal-open {
        overflow: hidden;
      }

      /* ì˜¤ë²„ë ˆì´ (ê³µìš©) */
      .overlay {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.45);
        z-index: 999;
      }
      .overlay.is-active {
        display: block;
      }

      /* ëª¨ë‹¬ ë˜í¼ */
      .modal {
        display: none;
        position: fixed;
        inset: 0;
        z-index: 1000;
        align-items: center;
        justify-content: center;
      }
      .modal.is-active {
        display: flex;
      }

      /* íŒ¨ë„ + ì „í™˜ (cart ëª¨ë‹¬ê³¼ ë™ì¼ ë„¤ì´ë° ì‚¬ìš© ê¶Œì¥) */
      .modal__panel {
        width: min(440px, 92vw);
        background: #fff;
        border-radius: 14px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.25);
        outline: none;
        transform: translateY(8px);
        opacity: 0;
        transition: transform 0.18s ease, opacity 0.18s ease;
      }
      .modal.is-active .modal__panel {
        transform: translateY(0);
        opacity: 1;
      }

      .modal__header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 16px 18px;
        border-bottom: 1px solid #eee;
      }
      .modal__header h2 {
        margin: 0;
        font-size: 18px;
      }
      .modal__close {
        appearance: none;
        border: 0;
        background: transparent;
        font-size: 20px;
        cursor: pointer;
      }
      .modal__body {
        padding: 18px;
      }

      .btn {
        width: 100%;
        padding: 12px 14px;
        border: 1px solid #ddd;
        background: #fff;
        border-radius: 10px;
        cursor: pointer;
        font-weight: 700;
      }
      .btn:hover {
        background: #f7f7f7;
      }

      /* ë°ëª¨ìš© ë„¤ë¹„ (í”„ë¡œì íŠ¸ì—ì„œëŠ” ê¸°ì¡´ í—¤ë” ì‚¬ìš©) */
      header {
        padding: 14px 16px;
        border-bottom: 1px solid #eee;
      }
      nav ul {
        display: flex;
        gap: 12px;
        padding: 0;
        margin: 0;
        list-style: none;
      }
      nav a,
      nav button {
        padding: 8px 10px;
        border: 1px solid #ddd;
        border-radius: 8px;
        background: #fff;
        cursor: pointer;
      }
      .rbt-login-modal-activation {
        list-style: none;
      }
    </style>
  </head>
  <body>
    <!-- ë°ëª¨ ë„¤ë¹„: ì‹¤ì œ í”„ë¡œì íŠ¸ì—ì„  ê¸°ì¡´ í—¤ë” ìœ ì§€ -->
    <header>
      <nav>
        <ul>
          <li><a href="#">í™ˆ</a></li>
          <li><a href="#">ì¥ë°”êµ¬ë‹ˆ</a></li>
          <li class="rbt-login-modal-activation">
            <a href="#" id="loginLink">ë¡œê·¸ì¸</a>
          </li>
        </ul>
      </nav>
    </header>

    <!-- ê³µìš© ì˜¤ë²„ë ˆì´ (í”„ë¡œì íŠ¸ì˜ #overlayë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš© ê¶Œì¥) -->
    <div id="overlay" class="overlay" aria-hidden="true"></div>

    <!-- ë¡œê·¸ì¸ ëª¨ë‹¬ -->
    <div
      id="loginModal"
      class="modal"
      role="dialog"
      aria-modal="true"
      aria-labelledby="loginModalTitle"
      aria-hidden="true"
    >
      <div class="modal__panel" tabindex="-1">
        <div class="modal__header">
          <h2 id="loginModalTitle">ë¡œê·¸ì¸</h2>
          <button
            type="button"
            class="modal__close"
            data-close-modal
            aria-label="ë‹«ê¸°"
          >
            Ã—
          </button>
        </div>
        <div class="modal__body">
          <button
            type="button"
            id="btnGoogleLogin"
            class="btn"
            aria-label="Googleë¡œ ë¡œê·¸ì¸"
          >
            ğŸ” Googleë¡œ ë¡œê·¸ì¸
          </button>
        </div>
      </div>
    </div>

    <script>
      (function () {
        const overlay = document.getElementById("overlay"); // ê³µìš©
        const loginModal = document.getElementById("loginModal"); // ëŒ€ìƒ ëª¨ë‹¬
        const panel = loginModal.querySelector(".modal__panel");
        const openers = document.querySelectorAll(
          ".rbt-login-modal-activation a, .rbt-login-modal-activation button"
        );
        const closers = loginModal.querySelectorAll("[data-close-modal]");

        // ìŠ¤í¬ë¡¤ ì ê¸ˆ/í•´ì œ
        const lock = () => document.body.classList.add("modal-open");
        const unlock = () => document.body.classList.remove("modal-open");

        // í¬ì»¤ìŠ¤ ê°€ëŠ¥í•œ ìš”ì†Œ
        const focusableSelector = [
          "a[href]",
          "button:not([disabled])",
          "textarea:not([disabled])",
          "input:not([disabled])",
          "select:not([disabled])",
          '[tabindex]:not([tabindex="-1"])',
        ].join(",");
        const getFocusable = (container) =>
          Array.from(container.querySelectorAll(focusableSelector)).filter(
            (el) => el.offsetParent !== null
          );

        let lastFocused = null;

        function openLoginModal() {
          lastFocused = document.activeElement;

          overlay.classList.add("is-active");
          loginModal.classList.add("is-active");
          overlay.setAttribute("aria-hidden", "false");
          loginModal.setAttribute("aria-hidden", "false");
          lock();

          const focusables = getFocusable(loginModal);
          (focusables[0] || panel).focus();
        }

        function closeLoginModal() {
          overlay.classList.remove("is-active");
          loginModal.classList.remove("is-active");
          overlay.setAttribute("aria-hidden", "true");
          loginModal.setAttribute("aria-hidden", "true");
          unlock();

          if (lastFocused && lastFocused.focus) lastFocused.focus();
        }

        // ì—´ê¸° íŠ¸ë¦¬ê±° (ê¸°ì¡´ êµ¬ì¡° ì¡´ì¤‘)
        openers.forEach((opener) => {
          opener.addEventListener("click", (e) => {
            e.preventDefault();
            openLoginModal();
          });
        });

        // ë‹«ê¸° ë²„íŠ¼
        closers.forEach((btn) =>
          btn.addEventListener("click", closeLoginModal)
        );

        // ì˜¤ë²„ë ˆì´ í´ë¦­ ì‹œ ë‹«ê¸°(ê³µìš© overlay ê°€ì •)
        overlay.addEventListener("click", () => {
          if (loginModal.classList.contains("is-active")) closeLoginModal();
        });

        // ESC & Tab í¬ì»¤ìŠ¤ íŠ¸ë©
        document.addEventListener("keydown", (e) => {
          if (!loginModal.classList.contains("is-active")) return;

          const focusables = getFocusable(loginModal);
          const first = focusables[0];
          const last = focusables[focusables.length - 1];

          if (e.key === "Escape") {
            e.preventDefault();
            closeLoginModal();
            return;
          }

          if (e.key === "Tab" && focusables.length) {
            if (e.shiftKey && document.activeElement === first) {
              e.preventDefault();
              last.focus();
            } else if (!e.shiftKey && document.activeElement === last) {
              e.preventDefault();
              first.focus();
            }
          }
        });

        // Google ë¡œê·¸ì¸ ë²„íŠ¼ (ì—°ë™ Hook)
        const googleBtn = document.getElementById("btnGoogleLogin");
        if (googleBtn) {
          googleBtn.addEventListener("click", () => {
            // TODO: ì‹¤ì œ OAuth ì—°ë™ (ì˜ˆ: location.href = '/auth/google')
            console.log("Google ë¡œê·¸ì¸ ì‹œì‘");
          });
        }
      })();
    </script>
  </body>
</html>
